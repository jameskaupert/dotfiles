#!/bin/bash
set -e

echo "ğŸš€ Setting up Arch development environment..."

# System packages
echo "ğŸ“¦ Installing system packages..."
sudo pacman -Syu --noconfirm
sudo pacman -S --noconfirm base-devel git curl wget unzip docker docker-compose wezterm

# Docker setup
echo "ğŸ³ Setting up Docker..."
sudo systemctl enable docker
sudo systemctl start docker
sudo usermod -aG docker $USER

# AUR helper
echo "ğŸ“¦ Installing AUR helper..."
if ! command -v yay &> /dev/null; then
    cd /tmp
    git clone https://aur.archlinux.org/yay.git
    cd yay
    makepkg -si --noconfirm
    cd ~
fi

# Mise
echo "ğŸ”§ Installing mise..."
curl https://mise.run | sh
export PATH="$HOME/.local/bin:$PATH"

# Chezmoi
echo "ğŸ  Setting up chezmoi..."
sudo pacman -S --noconfirm chezmoi
if [ ! -z "$DOTFILES_REPO" ]; then
    chezmoi init --apply $DOTFILES_REPO
fi

# Zsh setup
echo "ğŸš Setting up zsh..."

# Install zsh if not already installed
sudo pacman -S --noconfirm zsh zsh-completions

# Change default shell to zsh
if command -v zsh >/dev/null; then
    echo "Changing default shell to zsh..."
    sudo chsh -s $(command -v zsh) $USER
    echo "âš ï¸  You'll need to log out and back in for shell change to take effect"
fi

# Verify zsh installation
if command -v zsh &> /dev/null; then
    echo "âœ… Zsh installed successfully"
    zsh --version
else
    echo "âŒ Zsh installation failed"
    exit 1
fi

